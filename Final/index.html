<html>
  <head>
    <title>Chicago Transport</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://skeate.dev/Leaflet.timeline/examples/leaflet.timeline.js"></script>
    <script src="https://Ldepablo11.github.io/Final/Mismatch.js"></script>
    <style>
      html,
      body {
	      margin: 0;
	      padding: 0;
      }
      #map {
	      width: 100vw;
	      height: 100vh;
      }
      .leaflet-bottom.leaflet-left {
	      width: 100%;
      }
      .leaflet-control-container .leaflet-timeline-controls {
	      box-sizing: border-box;
	      width: 100%;
	      margin: 0;
	      margin-bottom: 15px;
      }
      .opacity-control {
	      position: absolute;
	      bottom: 10px;
	      right: 10px;
	      padding: 6px 8px;
	      font: 14px/16px Arial, Helvetica, sans-serif;
	      background: white;
	      background: rgba(255, 255, 255, 0.8);
	      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
	      border-radius: 5px;
	      width: 150px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var background =
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
		attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
		maxZoom: 16
	});
      
      var map = L.map("map", {
	      layers: [background],
	      center: new L.LatLng(41.76267620290796, -87.58033286917859),
	      zoom: 11,
      });

      var variables = ["Data_DP03", "Data_DP_01", "Data_index"];
	    
      var opacityControl = L.control({position: 'bottomright'});
	    
      opacityControl.onAdd = function (map) {
	      var div = L.DomUtil.create('div', 'leaflet-bar opacity-control');
	      div.innerHTML = '<h4>Select Opacity Variable:</h4>';
	      variables.forEach(function (variable) {
		      div.innerHTML += '<input type="radio" name="opacity" value="' + variable + '"> ' + variable + '<br>';
	      });
	      
	      div.addEventListener('change', function (e) {
		      var selectedVariable = e.target.value;
		      updateOpacity(selectedVariable);
	      });
	      return div;
      };
	    
      opacityControl.addTo(map);
      
      var selectedVariable = 'Data_index';

      function updateOpacity(variable) {
	      selectedVariable = variable;
	      chicago.setStyle(style);
      }

      function style(feature) {
	      var opacityProperty;
	      if (selectedVariable === 'Data_DP03') {
		      opacityProperty = feature.properties.Data_DP03 / 100;
	      } else if (selectedVariable === 'Data_DP_01') {
		      opacityProperty = feature.properties.Data_DP_01 / 100;
	      } else if (selectedVariable === 'Data_index') {
		      opacityProperty = feature.properties.Data_index;
	      }
	      
	      return {
		      fillColor: "#000C66",
		      weight: 2,
		      opacity: 1,
		      color: 'black',
		      fillOpacity: opacityProperty
	      };
      }

      function bindTooltip(layer, properties) {
	      layer.bindTooltip('<h3>' + properties.Data_name10 + '</h3>' +
				'<p>Unemployment Rate: <strong>' + (properties.Data_DP03 || 'N/A') + '%</strong><br>' +
				'Share of Public Transit Commuters: <strong>' + (properties.Data_DP_01 || 'N/A') + '%</strong><br>' +
				'Vulnerability Index: <strong>' + (properties.Data_index || 'N/A') + '</strong></p>');
      }

      function onEachFeature(feature, layer) {
	      if (feature.properties) {
		      bindTooltip(layer, feature.properties);
	      }
      }
	    
      var chicago = new L.geoJson(transit, {
	      style: style,
      	      onEachFeature: onEachFeature
      }).addTo(map);

    </script>
  </body>
</html>
